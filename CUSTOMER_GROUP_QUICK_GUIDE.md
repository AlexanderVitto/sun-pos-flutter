# ğŸ¯ Customer Group Feature - Quick Guide

## ğŸ“± Visual Demo

### **1. Form Tambah Customer - SEBELUM**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• Add New Customer              âŒ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  Full Name *                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘¤ John Doe                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  Phone Number *                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ +62812345678                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚           [Cancel]  [Add Customer]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Form Tambah Customer - SETELAH (With Customer Group)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• Add New Customer              âŒ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  Full Name *                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘¤ John Doe                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  Phone Number *                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ +62812345678                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  Customer Group (Optional)        â–¼   â”‚  â† âœ¨ NEW!
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘¥ B - Agen      [10.00%]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚           [Cancel]  [Add Customer]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Customer Group Dropdown - Expanded**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer Group (Optional)        â–¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  A - Retail           [0.00%]      â”‚  â”‚  â† No discount
â”‚  B - Agen            [10.00%]      â”‚  â”‚  â† 10% off
â”‚  C - Grosir          [15.00%]      â”‚  â”‚  â† 15% off
â”‚  D - VIP             [20.00%]      â”‚  â”‚  â† 20% off
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ User Flow

### **Skenario: Membuat Customer Agen**

```
ğŸ“± User Action                    ğŸ’» System Response
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Klik "Add Customer"       â†’   Open dialog

2. Loading...                â†   Fetch customer groups
                                  GET /api/v1/customer-groups

3. Dialog terbuka            â†   Show form with groups loaded

4. Isi nama: "John Doe"      â†’   Validate name

5. Isi phone: "+628123..."   â†’   Validate phone

6. Pilih group: "B - Agen"   â†’   Select group (id: 2)

7. Klik "Add Customer"       â†’   POST /api/v1/customers
                                  {
                                    "name": "John Doe",
                                    "phone": "+62812345678",
                                    "customer_group_id": 2
                                  }

8. Success! âœ…               â†   Customer created
                                  Show success message
                                  Close dialog
```

---

## ğŸ“Š Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AddCustomer    â”‚
â”‚     Dialog      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ initState()
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer       â”‚
â”‚   Provider      â”‚â—„â”€â”€â”€â”€â”€â”€ loadCustomerGroups()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ API Call
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer API   â”‚
â”‚    Service      â”‚â—„â”€â”€â”€â”€â”€â”€ GET /customer-groups
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP Request
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend API   â”‚
â”‚  (Laravel/PHP)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Response
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CustomerGroupListResponse  â”‚
â”‚  {                          â”‚
â”‚    status: "success",       â”‚
â”‚    data: [                  â”‚
â”‚      {id: 1, name: "A"...}, â”‚
â”‚      {id: 2, name: "B"...}  â”‚
â”‚    ]                        â”‚
â”‚  }                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Parse & Store
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  _customerGroupsâ”‚
â”‚  List<Group>    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ notifyListeners()
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Rebuilds    â”‚
â”‚  Show Dropdown  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Structure

### **customers Table**

```sql
CREATE TABLE customers (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  phone VARCHAR(20) NOT NULL,
  customer_group_id BIGINT NULL,  â† NEW COLUMN
  created_at TIMESTAMP,
  updated_at TIMESTAMP,

  FOREIGN KEY (customer_group_id)
    REFERENCES customer_groups(id)
);
```

### **customer_groups Table**

```sql
CREATE TABLE customer_groups (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  discount_percentage DECIMAL(5,2) DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

---

## ğŸ¨ UI Components Breakdown

### **1. Loading State**

```dart
if (customerProvider.isLoadingGroups)
  const Center(
    child: CircularProgressIndicator(),
  )
```

**Visual:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer Group            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     â³ Loading...   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Dropdown with Groups**

```dart
DropdownButtonFormField<CustomerGroup>(
  items: groups.map((group) =>
    DropdownMenuItem(
      value: group,
      child: Row(
        children: [
          Text(group.name),
          Badge(group.formattedDiscount),
        ],
      ),
    ),
  ),
)
```

**Visual:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  B - Agen        [10.00%]  â–¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Discount Badge**

```dart
Container(
  padding: EdgeInsets.symmetric(h: 8, v: 4),
  decoration: BoxDecoration(
    color: Colors.green[50],
    border: Border.all(color: Colors.green[300]),
    borderRadius: BorderRadius.circular(4),
  ),
  child: Text(
    group.formattedDiscount,
    style: TextStyle(
      color: Colors.green[700],
      fontWeight: FontWeight.bold,
    ),
  ),
)
```

**Visual:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10.00% â”‚  â† Green badge
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Testing Scenarios

### âœ… **Scenario 1: Happy Path**

```
1. User opens add customer dialog
2. Customer groups load successfully
3. User selects "B - Agen" (10% discount)
4. User fills name and phone
5. Customer created with group_id = 2
âœ… SUCCESS: Customer has 10% discount
```

### âœ… **Scenario 2: No Group Selected**

```
1. User opens add customer dialog
2. User leaves customer group empty
3. User fills name and phone
4. Customer created without group_id
âœ… SUCCESS: Backward compatible
```

### âœ… **Scenario 3: Groups Load Failed**

```
1. User opens add customer dialog
2. API fails to load groups
3. Dropdown not shown
4. User can still create customer
âœ… SUCCESS: Graceful degradation
```

---

## ğŸ“± Real-World Example

### **Customer: Toko Maju Jaya**

**Before (No Group):**

```
Customer: Toko Maju Jaya
Phone: +628123456789
Group: -
Discount: 0%

Purchase: Rp 1,000,000
Total: Rp 1,000,000
```

**After (Agen Group - 10%):**

```
Customer: Toko Maju Jaya
Phone: +628123456789
Group: B - Agen
Discount: 10%

Purchase: Rp 1,000,000
Discount: - Rp 100,000
Total: Rp 900,000  â† Save Rp 100k!
```

---

## ğŸ¯ Key Benefits

### **For Business:**

- ğŸ“Š Better customer segmentation
- ğŸ’° Automated discount management
- ğŸ“ˆ Increase customer loyalty
- ğŸ¯ Targeted pricing strategy

### **For Users:**

- ğŸš€ Quick customer categorization
- âœ¨ Visual discount feedback
- ğŸ“± Clean, intuitive UI
- âš¡ Fast customer creation

---

## ğŸ”§ Technical Highlights

### **Code Quality:**

- âœ… Clean architecture (Model-Provider-Service)
- âœ… Type-safe with proper null handling
- âœ… Error handling at every layer
- âœ… Backward compatible
- âœ… Performance optimized (auto-load on init)

### **User Experience:**

- âœ… Auto-load groups on dialog open
- âœ… Visual discount indicators
- âœ… Optional field (not mandatory)
- âœ… Loading states
- âœ… Error states with messages

---

## ğŸš€ Quick Start

### **1. Create Customer with Group**

```dart
// Open dialog
showDialog(
  context: context,
  builder: (context) => const AddCustomerDialog(),
);

// Groups auto-loaded
// User selects group
// Submit form

// Result: Customer with group_id
```

### **2. Access Customer Groups**

```dart
final provider = Provider.of<CustomerProvider>(context);

// Load groups
await provider.loadCustomerGroups();

// Access groups
final groups = provider.customerGroups;

// Check loading
if (provider.isLoadingGroups) {
  // Show loading
}
```

---

## ğŸ“ Summary

**What We Built:**

- âœ… Customer Group model & API integration
- âœ… Smart dropdown with discount display
- âœ… Auto-load groups on dialog init
- âœ… Optional field (backward compatible)
- âœ… Clean error handling

**Impact:**

- ğŸ¯ Better customer management
- ğŸ’° Automated discounting
- ğŸ“Š Customer segmentation
- âœ¨ Professional UI/UX

**Files Changed:** 6 files
**Lines Added:** ~400 lines
**Breaking Changes:** None âœ…

---

**ğŸ‰ Feature Complete & Ready for Production!**
